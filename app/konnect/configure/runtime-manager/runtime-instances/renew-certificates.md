---
title: Renew Certificates for a Runtime Instance
no_version: true
---

Runtime certificates generated by {{site.konnect_saas}} expire every six (6)
months.

Renew your certificates to prevent any interruption in communication between
{{site.konnect_saas}} and any configured runtimes (data planes). If a
certificate expires and is not replaced:
* The runtime instance stops receiving configuration updates from
the control plane.
* The runtime instance stops sending [Vitals](/konnect/vitals) and usage data
to the control plane.
* Each disconnected runtime instance uses cached configuration to continue
proxying and routing traffic.

Depending on your setup, renewing certificates might mean bringing up a new data
plane, or generating new certificates and updating data planes with the new
files.

## Quick setup

If you originally created your runtime instance container using the
[quick setup Docker script](/konnect/configure/runtime-manager/runtime-instances/gateway-runtime-docker/#quick-setup),
we recommend running the script again to create a new instance with renewed
certificates.

1. Stop the runtime instance container.
2. Open ![runtimes icon](/assets/images/icons/konnect/icn-runtimes.svg){:.inline .konnect-icn .no-image-expand}
Runtime Manager, select a runtime group, and click **+ New Runtime Instance**.
3. Run the script again to
[create a new runtime instance](/konnect/configure/runtime-manager/runtime-instances/gateway-runtime-docker/#quick-setup) with
updated certificates.
4. Remove the old runtime instance container.

## Advanced setup

If your runtime instances are running on Linux or Kubernetes, or if you have a
Docker container that was _not_ created using the quick setup script,
generate new certificates and replace them on the existing nodes.

### Generate new certificates

1. Open ![runtimes icon](/assets/images/icons/konnect/icn-runtimes.svg){:.inline .konnect-icn .no-image-expand}
Runtime Manager, select a runtime group, and click **+ New Runtime Instance**.
2. Open the tab that suits your environment: **Linux** or **Kubernetes**.

    If you're running a Docker container, you can use either of these tabs to
    complete the following steps.

3. Click **Generate Certificate**.
4. Save the new certificates and key into separate files:

    * Certificate: `tls.crt`
    * Private key: `tls.key`
    * Root CA Certificate: `ca.crt`

5. Store the files on your runtime's local filesystem.

### Update data plane

{% navtabs %}
{% navtab Linux %}

Open your instance's `kong.conf` file. Replace existing certificates with
the new files:

<pre><code>cluster_cert = /<div contenteditable="true">{PATH_TO_FILE}</div>/tls.crt
cluster_cert_key = /<div contenteditable="true">{PATH_TO_FILE}</div>/tls.key
lua_ssl_trusted_certificate = system,/<div contenteditable="true">{PATH_TO_FILE}</div>/ca.crt</code></pre>

Restart {{site.base_gateway}} for the settings to take effect:

```sh
kong restart
```

Clean up by deleting any old certificate and key files on your filesystem.

{% endnavtab %}
{% navtab Kubernetes %}

Create new secrets for the certificates and key, making sure to name them
something different from your current secret names.

1. Create a `tls` secret using the `tls.cert` and `tls.key` files
you saved earlier:

    <pre><code>kubectl create secret tls kong-cluster-cert2 -n kong \
      --cert=/<div contenteditable="true">{PATH_TO_FILE}</div>/tls.crt \
      --key=/<div contenteditable="true">{PATH_TO_FILE}</div>/tls.key</code></pre>

2. Create a generic secret for the `ca.crt` file:

    <pre><code>kubectl create secret generic kong-cluster-ca2 -n kong \
      --from-file=ca.crt=/<div contenteditable="true">{PATH_TO_FILE}</div>/ca.crt</code></pre>

3. Open the `values.yaml` file for your runtime instance and update it to point
to the new secrets.

    Update the `secretVolumes` section:

    ```yaml
    secretVolumes:
    - kong-cluster-cert2
    - kong-cluster-ca2
    ```

    Update the cert values in the `env` section:
    ```yaml
    env:
      cluster_ca_cert: /etc/secrets/kong-cluster-ca2/ca.crt
      cluster_cert: /etc/secrets/kong-cluster-cert2/tls.crt
      cluster_cert_key: /etc/secrets/kong-cluster-cert2/tls.key
      lua_ssl_trusted_certificate: /etc/secrets/kong-cluster-ca2/ca.crt
    ```

4. Save the file. Reapply the configuration by running the Helm `upgrade`
command:

    ```bash
    helm upgrade my-kong kong/kong -n kong \
      --values ./values.yaml
    ```

5. Delete the old secrets.

    The `kong-cluster-cert` secret:
    ```sh
    kubectl delete secret kong-cluster-cert
    ```

    And the `kong-cluster-ca` secret:
    ```sh
    kubectl delete secret kong-cluster-ca
    ```
{% endnavtab %}
{% navtab Docker %}

In your Docker container, replace existing certificates on your runtime instances
with the new files and restart the Gateway:

<pre><code>echo "KONG_CLUSTER_CERT=/<div contenteditable="true">{PATH_TO_FILE}</div>/tls.crt \
  KONG_CLUSTER_CERT_KEY=/<div contenteditable="true">{PATH_TO_FILE}</div>/tls.key \
  KONG_LUA_SSL_TRUSTED_CERTIFICATE=/<div contenteditable="true">{PATH_TO_FILE}</div>/ca.crt \
  kong reload exit" | docker exec -i <div contenteditable="true">{KONG_CONTAINER_ID}</div> /bin/sh</code></pre>

Clean up by deleting any old certificate and key files on your filesystem.

{% endnavtab %}
{% endnavtabs %}
