---
title: Renew Certificates for a Runtime Instance
content_type: how-to
---

Runtime certificates generated by {{site.konnect_saas}} expire every ten
years. If you bring your own certificates, make sure to monitor the
expiration date.

Renew your certificates to prevent any interruption in communication between
{{site.konnect_saas}} and any configured runtimes, or data planes. If a
certificate expires and is not replaced:
* The runtime instance stops receiving configuration updates from
the control plane.
* The runtime instance stops sending [analytics](/konnect/analytics/) and usage data
to the control plane.
* Each disconnected runtime instance uses cached configuration to continue
proxying and routing traffic.

Depending on your setup, renewing certificates might mean bringing up a new data
plane, or generating new certificates and updating data planes with the new
files.

## Quick setup

If you originally created your runtime instance container using one of the
Docker options in Runtime Manager, we recommend creating a new instance with renewed
certificates.

1. Stop the runtime instance container.
2. Open {% konnect_icon runtimes %} **Runtime Manager**, select a runtime group,
 and click **New Runtime Instance**.
3. Run the script to create a new runtime instance with
updated certificates.
4. Remove the old runtime instance container.

## Advanced setup

If your runtime instances are running on Linux or Kubernetes, or if you have a
Docker container that was _not_ created using the quick setup script, you must
generate new certificates and replace them on the existing nodes.

### Generate new data plane certificate

{% navtabs %}
{% navtab Runtime Manager %}
You can generate a new data plane certificate from the {% konnect_icon runtimes %} **Runtime Manager**.

1. Select a runtime instance
1. Click **Runtime group actions** and select **Data plane certificates**. 
1. Click **Generate certificate**.

1. Save the new certificate and key into separate files:

    * certificate: `tls.crt`
    * private key: `tls.key`

1. Store the files on the local file system.
{% endnavtab %}

{% navtab Konnect API %}

You can generate a certificate locally and use the [pin data plane client certificate](https://developer.konghq.com/spec/3c38bff8-3b7b-4323-8e2e-690d35ef97e0/16adcd15-493a-49b2-ad53-8c73891e29bf#/DP%20Certificates/post-dp-client-certificates) endpoint to add it to Konnect.

1.  Generate a new certificate and key:

    ```bash
    openssl req -new -x509 -nodes -newkey rsa:2048 -subj "/CN=kongdp/C=US" -keyout ./tls.key -out ./tls.crt
    ```

1. Reformat the certificate into a single line for the API call:

    ```bash
    export CERT=$(awk 'NF {sub(/\r/, ""); printf "%s\\n",$0;}' tls.crt)
    ```

1. `POST` the certificate to your runtime group using the Konnect API:

    ```bash
    curl https://us.api.konghq.com/v2/runtime-groups/{runtimeGroupId}/dp-client-certificates --json '{"cert":"'$CERT'"}'
    ```
{% endnavtab %}
{% endnavtabs %}

### Update data plane

{% navtabs %}
{% navtab Linux %}

Open your instance's `kong.conf` file. Replace existing certificates with
the new files:

```sh
cluster_cert = /{PATH_TO_FILE}/tls.crt
cluster_cert_key = /{PATH_TO_FILE}/tls.key
```

Restart {{site.base_gateway}} for the settings to take effect:

```sh
kong restart
```

Delete any old certificate and key files on your filesystem.

{% endnavtab %}
{% navtab Kubernetes %}

Create new secrets for the certificates and key, making sure to name them
something different from the current secret names.

1. Create a `tls` secret using the `tls.cert` and `tls.key` files
you saved earlier:

    ```sh
    kubectl create secret tls kong-cluster-cert2 -n kong \
      --cert=/PATH_TO_FILE/tls.crt \
      --key=/PATH_TO_FILE/tls.key
    ```

1. Open the `values.yaml` file for your runtime instance and update it to point
to the new secrets.

    Update the `secretVolumes` section:

    ```yaml
    secretVolumes:
    - kong-cluster-cert2
    ```

    Update the cert values in the `env` section:
    ```yaml
    env:
      cluster_cert: /etc/secrets/kong-cluster-cert2/tls.crt
      cluster_cert_key: /etc/secrets/kong-cluster-cert2/tls.key
    ```

1. Save the file. Reapply the configuration by running the Helm `upgrade`
command:

    ```bash
    helm upgrade my-kong kong/kong -n kong \
      --values ./values.yaml
    ```

1. Delete the old `kong-cluster-cert` secret:

    ```sh
    kubectl delete secret kong-cluster-cert
    ```

{% endnavtab %}
{% navtab Docker %}

In your Docker container, replace any existing certificates on your runtime instances
with the new files and restart the Gateway:

```sh
echo "KONG_CLUSTER_CERT=/{PATH_TO_FILE}/tls.crt \
  KONG_CLUSTER_CERT_KEY=/{PATH_TO_FILE}/tls.key \
  kong reload exit" | docker exec -i {KONG_CONTAINER_ID} /bin/sh
```

Delete any old certificate and key files on your filesystem.

{% endnavtab %}
{% endnavtabs %}
