---
title: Integrating AWS Lambda Functions and Kong
class: page-install-method
---
# Integrating AWS Lambda Functions and Kong

The [AWS lambda plugin](https://getkong.org/plugins/aws-lambda) allows you to link an AWS lambda function execution like a call to an upstream. This allow us to leverage a remote code execution potentially making it a micro service itself.

## The Steps
1. Access to AWS Console as user allowed to operate with lambda functions and create user and roles.
2. Create an Execution role in AWS
3. Create an user which will be invoke the function via Kong, test it.
4. Create an API in Kong, add the aws-lambda plugin linked to our aws function and execute it.
 
## Configuration:

1. First, let's create an execution role called `LambdaExecutor` for our lambda function.
    
    In IAM Console create a new Role choosing the AWS Lambda service, there will be no policies as our function in this example will simply execute itself giving us back an hardcoded JSON as response without accessing other AWS resources.

2. Now let's create a user named KongInvoker, used by our Kong API gateway to invoke the function.
    
    In IAM Console create a new user, must be provided to it programmatic access via Access and Secret keys; then will attach existing policies directly particularly the AWSLambdaRole predefined. Once the user creation is confirmed, store Access Key and Secret Key in a safe place.

3. Now we need to create the lambda function itself, will do so in N.Virginia Region (code us-east-1).
    
    In Lambda Management, create a new function Mylambda, there will be no blueprint as we are going to paste the code below; for the execution role let's choose an existing role specifically LambdaExecutor created previously

    Use the inline code below to have a simple JSON response in return, note this is code for Python 3.6 interpreter.

    ```python
    import json
    def lambda_handler(event, context):
        jsonbody='''{"response": "yes"}'''
        return json.loads(jsonbody)
    ```

    Test the lambda function from the AWS console and make sure the execution succeeds. 

4. Finally we setup the api in Kong and link it to the function just created.

    The api that we are going to create doesn't really need a real `upstream_url` since we are not going to have an HTTP call to upstream but rather a response generated by our function.

    ```bash
    curl -i -X POST http://{kong_hostname}:8001/apis \
    --data 'name=lambda1' \
    --data 'upstream_url=http://localhost:8000' \
    --data 'uris=/lambda1'
    ```

    Add the plugin:

    ```bash
    curl -i -X POST http://{kong_hostname}:8001/apis/lambda1/plugins \
    --data 'name=aws-lambda' \
    --data 'config.aws_key={KongInvoker user key}' \
    --data 'config.aws_secret={KongInvoker user secret}' \
    --data 'config.aws_region=us-east-1' \
    --data 'config.function_name=MyLambda'
    ```

    Call the Api and verify the correct invocation, execution and response:

    ```bash
    curl http://{kong_hostname}:8000/lambda1
    ```

    Additional headers:

    ```
    x-amzn-Remapped-Content-Length, X-Amzn-Trace-Id, x-amzn-RequestId
    ```

    JSON response:

    ```json
    {"response": "yes"}
    ```

Have fun leveraging the power of AWS Lambda in Kong.
